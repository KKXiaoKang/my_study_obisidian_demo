问得非常好！你已经触及了所有基于优化的算法最核心的设计思想。

问题的答案是：**梯度的大小，并不是随意定义的，它完全是由我们选择的代价函数（Cost Function）通过数学求导得出的。**

这背后没有一个通用的“梯度大小计算范式”，但有一个通用的**“设计-推导”范式**。

---

### 真正的“统一范式”：两步走

这个真正的“范式”分为两步，这适用于几乎所有的优化问题：

1.  **第一步（设计）：定义代价函数 \(C(x)\)**
    *   这是“艺术”和“工程”的部分。我们需要设计一个数学函数，这个函数的值能够衡量我们当前的状态“有多糟糕”。
    *   在我们的例子中，我们想表达“离障碍物越近越糟糕”。我们选择了二次函数（平方关系）来描述这种“糟糕”程度：
        $$
        C(\text{dist}) = \frac{1}{2} w_{\text{obs}} (d_{\text{safe}} - \text{dist})^2
        $$
    *   **我们为什么选择这个函数？**因为它有两个好特性：
        a. 当距离 `dist` 大于 `d_safe` 时，代价为零（或我们不计算它）。
        b. 当距离 `dist` 小于 `d_safe` 时，代价会随着 `dist` 的减小而**急剧（二次方）增大**。这提供了很强的排斥效果。

2.  **第二步（推导）：计算代价函数的梯度 \(\nabla C(x)\)**
    *   这是“数学”和“科学”的部分。一旦代价函数被确定，它的梯度就**唯一地**被数学法则（微积分）确定了。
    *   **梯度（Gradient）的本质，就是代价函数对自变量的导数（Derivative）。** 梯度描述了当自变量（我们的轨迹点位置）发生微小变化时，代价函数变化最快的方向和速率。

---

### 应用范式：从我们的代价函数推导出梯度大小

现在，我们把第二步应用到我们设计的代价函数上。

*   **代价函数 $(C)$**： $(C = \frac{1}{2} w_{\text{obs}} (d_{\text{safe}} - d)^2$
*   **自变量 $(x)$**：在这里，我们关心的是代价 $C$ 如何随着**距离 $d$** 变化，所以我们先对 $d$ 求导。

使用微积分的链式法则求导 $\frac{dC}{dd}$：
$$
\frac{dC}{dd} = \frac{d}{dd} \left[ \frac{1}{2} w_{\text{obs}} (d_{\text{safe}} - d)^2 \right]
$$
1.  常数 $\frac{1}{2} w_{\text{obs}}$ 不变。
2.  对 $(d_{\text{safe}} - d)^2$ 求导，得到 $2 \cdot (d_{\text{safe}} - d)$。
3.  对括号内的 $(d_{\text{safe}} - d)$ 对 \(d\) 求导，得到 \(-1\)。

把它们乘起来：
$$
\frac{dC}{dd} = \frac{1}{2} w_{\text{obs}} \cdot 2 \cdot (d_{\text{safe}} - d) \cdot (-1)
$$
$$
\frac{dC}{dd} = -w_{\text{obs}} (d_{\text{safe}} - d)
$$

**看到了吗？我们代码中梯度大小的计算公式 `-OBSTACLE_WEIGHT * (SAFE_DIST - d_to_obs[inside])` 正是这样通过对我们选择的二次代价函数求导而来的！**

---

### 总结

*   **为什么是这个公式？**
    因为它是一个**二次（quadratic）代价函数**的导数。这个选择提供了“越近推力越大”的线性增长的排斥力（类似于弹簧的胡克定律 $F=-kx$，其中势能是 $\frac{1}{2}kx^2$)。

*   **有统一的数学范式吗？**
    有，但这个范式不是一个固定的公式，而是一个**过程**：
    1.  **根据你的需求，设计一个合理的代价函数。** （你想让排斥力恒定？用线性代价。你想让排斥力随距离指数增长？用指数代价。）
    2.  **通过微积分计算这个代价函数的导数，得到梯度。**

你选择什么样的代价函数，就会得到什么样的梯度公式。我们选择了一个二次函数，所以得到了一个线性的梯度大小。